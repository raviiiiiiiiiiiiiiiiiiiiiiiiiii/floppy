<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Floppy F4ck</title>
<style>
    body { margin:0; font-family:Arial; background:#111; color:white; text-align:center; }
    #menu {
        padding:20px; max-width:400px; margin:auto;
        background:#1c1c1c; border-radius:10px;
        margin-top:20px;
    }
    h1 { font-size:28px; color:#0fdb8f; }
    h3 { color:#bbb; margin-top:5px; font-size:14px; }
    label { font-size:15px; margin-top:14px; display:block; }
    input { display:block; margin:6px auto 14px auto; }
    button {
        background:#00eaff; border:none; padding:12px 25px;
        border-radius:8px; cursor:pointer; margin-top:20px;
        font-size:16px; font-weight:bold;
    }
    #gameCanvas { display:none; margin:auto; margin-top:20px; background:#000; }
</style>
</head>
<body>

<h1>Floppy F4ck ðŸ”¥</h1>
<h3>Why should developers have all the fun?</h3>

<div id="menu">
    <h2>Create Your Game ðŸ‘‡</h2>

    <label>Character Image (Required)</label>
    <input type="file" id="charImg" accept="image/*">

    <label>Obstacle Image</label>
    <input type="file" id="obImg" accept="image/*">

    <label>Background Image</label>
    <input type="file" id="bgImg" accept="image/*">

    <label>Game Music (mp3)</label>
    <input type="file" id="bgMusic" accept="audio/*">

    <label>Death Sound</label>
    <input type="file" id="deathSound" accept="audio/*">

    <label>Game Over Text</label>
    <input type="text" id="goText" placeholder="Game Over!">

    <label>Game Over Image (Optional)</label>
    <input type="file" id="goImg" accept="image/*">

    <button onclick="startSetup()">Generate Game âœ…</button>
</div>

<canvas id="gameCanvas" width="360" height="600"></canvas>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

let gravity = 0.35, jump = -7;
let pipeSpeed = 2.2, gap = 165;
let pipeW = 60, charSize = 35;
let player, pipes, score, isGameOver, restartBtn;

let images = {
    charImg:new Image(), obImg:new Image(), bgImg:new Image(), goImg:new Image()
};
let sounds = {
    bg:new Audio(), death:new Audio()
};

function to64(f){ return new Promise(res=>{
    if(!f) return res("");
    let r=new FileReader(); r.onload=()=>res(r.result); r.readAsDataURL(f);
});}

async function startSetup(){
    let input = id=>document.getElementById(id);
    let [ci,oi,bi,bm,dm,gi] = await Promise.all([
        to64(input("charImg").files[0]),
        to64(input("obImg").files[0]),
        to64(input("bgImg").files[0]),
        to64(input("bgMusic").files[0]),
        to64(input("deathSound").files[0]),
        to64(input("goImg").files[0]),
    ]);

    images.charImg.src = ci;
    images.obImg.src = oi;
    images.bgImg.src = bi;
    images.goImg.src = gi;

    if(bm) sounds.bg.src = bm;
    if(dm) sounds.death.src = dm;

    startGame(input("goText").value || "Game Over!");
}

function startGame(goText){
    document.getElementById("menu").style.display="none";
    canvas.style.display="block";

    player = {x:100,y:250,vy:0};
    pipes = [];
    score = 0;
    isGameOver = false;

    if(sounds.bg.src){ sounds.bg.loop=true; sounds.bg.play(); }

    canvas.onmousedown = ()=> player.vy = jump;
    canvas.ontouchstart = ()=> player.vy = jump;

    setInterval(()=> {
        if(isGameOver) return;
        let top = Math.random()*220+50;
        pipes.push({x:360,top:top,passed:false});
    },1450);

    function loop(){
        if(isGameOver) return drawGameOver(goText);

        ctx.clearRect(0,0,360,600);

        if(images.bgImg.src) ctx.drawImage(images.bgImg,0,0,360,600);

        player.vy += gravity;
        player.y += player.vy;
        ctx.drawImage(images.charImg, player.x, player.y, charSize, charSize);

        pipes.forEach(p=>{
            p.x -= pipeSpeed;
            ctx.drawImage(images.obImg,p.x,0,pipeW,p.top);
            ctx.drawImage(images.obImg,p.x,p.top+gap,pipeW,600-p.top-gap);

            if(!p.passed && p.x+pipeW < player.x){
                p.passed=true;
                score++;
            }

            if(player.x + charSize > p.x && player.x < p.x + pipeW &&
               (player.y < p.top || player.y + charSize > p.top + gap)){
                triggerDeath();
            }
        });

        if(player.y > 560 || player.y < 0) triggerDeath();

        ctx.fillStyle="white";
        ctx.font="28px Arial";
        ctx.fillText(score, 20,40);

        requestAnimationFrame(loop);
    }
    loop();
}

function triggerDeath(){
    isGameOver = true;
    if(sounds.bg.src) sounds.bg.pause();
    if(sounds.death.src) sounds.death.play();
}

function drawGameOver(t){
    ctx.fillStyle="rgba(0,0,0,0.75)";
    ctx.fillRect(0,0,360,600);

    ctx.fillStyle="#fff";
    ctx.font="34px Arial";
    ctx.fillText(score, 170,100);

    let textY = 270;
    if(images.goImg.src) ctx.drawImage(images.goImg,80,150,200,200);
    else { ctx.fillText(t,100,240); textY = 310; }

    ctx.font="20px Arial";
    ctx.fillText("RESTART",135,textY+60);

    canvas.onclick = ()=>location.reload();
}
</script>

</body>
</html>
