<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Floppy F4ck Maker</title>
<style>
    body { margin:0; font-family:Arial; background:#111; color:white; text-align:center; }
    #menu {
        padding:20px; max-width:400px; margin:auto;
        background:#1c1c1c; border-radius:10px;
        margin-top:20px;
    }
    h1 { font-size:28px; color:#0fdb8f; }
    h3 { color:#bbb; margin-top:5px; font-size:14px; }
    label { font-size:15px; margin-top:14px; display:block; }
    input { display:block; margin:6px auto 14px auto; }
    button {
        background:#00eaff; border:none; padding:12px 25px;
        border-radius:8px; cursor:pointer; margin-top:20px;
        font-size:16px; font-weight:bold;
    }
    button:hover { background:#00cce0; }
    #gameCanvas { display:none; background:black; margin:auto; margin-top:20px; }
</style>
</head>
<body>

<h1>Floppy F4ck</h1>
<h3>“Why should developers have all the fun?”</h3>

<div id="menu">
    <h2>Create Your Game</h2>

    <label>Character Image</label>
    <input type="file" id="charImg" accept="image/*">

    <label>Obstacle Image</label>
    <input type="file" id="obImg" accept="image/*">

    <label>Background Image</label>
    <input type="file" id="bgImg" accept="image/*">

    <label>Game Music (mp3)</label>
    <input type="file" id="bgMusic" accept="audio/*">

    <label>Death Sound</label>
    <input type="file" id="deathSound" accept="audio/*">

    <label>Game Over Text</label>
    <input type="text" id="goText" placeholder="Game Over!">

    <label>Game Over Image (Optional)</label>
    <input type="file" id="goImg" accept="image/*">

    <button onclick="startSetup()">Generate Game</button>
</div>

<canvas id="gameCanvas" width="360" height="600"></canvas>

<script>
let canvas = document.getElementById("gameCanvas");
let ctx = canvas.getContext("2d");

let player, pipes, score, gameOver;
let gravity = 0.4;
let jumpPower = -9;
let pipeSpeed = 2;
let gap = 180;
let pipeWidth = 60;
let charSize = 35;

let bgImg = new Image();
let charImg = new Image();
let obImg = new Image();
let goImg = new Image();

let bgMusic = new Audio();
let deathMusic = new Audio();

function toBase64(file, cb) {
    if (!file) return cb("");
    let r = new FileReader();
    r.onload = ()=> cb(r.result);
    r.readAsDataURL(file);
}

function startSetup() {
    Promise.all([
        new Promise(res => toBase64(document.getElementById("charImg").files[0], res)),
        new Promise(res => toBase64(document.getElementById("obImg").files[0], res)),
        new Promise(res => toBase64(document.getElementById("bgImg").files[0], res)),
        new Promise(res => toBase64(document.getElementById("bgMusic").files[0], res)),
        new Promise(res => toBase64(document.getElementById("deathSound").files[0], res)),
        new Promise(res => toBase64(document.getElementById("goImg").files[0], res)),
    ]).then(([ci, oi, bi, bm, dm, gi]) => {
        charImg.src = ci;
        obImg.src = oi;
        bgImg.src = bi;
        bgMusic.src = bm;
        deathMusic.src = dm;
        goImg.src = gi;

        let goText = document.getElementById("goText").value || "Game Over";
        startGame(goText);
    });
}

function startGame(goText) {
    document.getElementById("menu").style.display = "none";
    canvas.style.display = "block";

    if(bgMusic.src) bgMusic.play();
    bgMusic.loop = true;

    player = { x:100, y:250, vy:0 };
    pipes = [];
    score = 0;
    gameOver = false;

    canvas.addEventListener("touchstart", ()=> player.vy = jumpPower);
    canvas.addEventListener("mousedown", ()=> player.vy = jumpPower);

    setInterval(()=> {
        let topH = Math.random()*220 + 50;
        pipes.push({ x:360, top: topH });
    }, 1500);

    function loop(){
        if(gameOver) return drawGameOver(goText);

        ctx.clearRect(0,0,360,600);

        if(bgImg.src) ctx.drawImage(bgImg,0,0,360,600);

        player.vy += gravity;
        player.y += player.vy;
        ctx.drawImage(charImg, player.x, player.y, charSize, charSize);

        for(let p of pipes){
            p.x -= pipeSpeed;

            ctx.drawImage(obImg, p.x, 0, pipeWidth, p.top);
            ctx.drawImage(obImg, p.x, p.top + gap, pipeWidth, 600 - p.top - gap);

            if(player.x+charSize > p.x && player.x < p.x + pipeWidth &&
               (player.y < p.top || player.y+charSize > p.top+gap)) {
                die();
            }

            if(p.x === player.x) score++;
        }

        if(player.y > 560 || player.y < 0) die();

        ctx.fillStyle="white";
        ctx.font="26px Arial";
        ctx.fillText("Score: "+score, 10,30);

        requestAnimationFrame(loop);
    }
    loop();
}

function die(){
    gameOver = true;
    if(bgMusic.src) bgMusic.pause();
    if(deathMusic.src) deathMusic.play();
}

function drawGameOver(msg){
    ctx.fillStyle="rgba(0,0,0,0.65)";
    ctx.fillRect(0,0,360,600);

    if(goImg.src) {
        let w = 200, h = 200;
        ctx.drawImage(goImg, 80,150,w,h);
    } else {
        ctx.fillStyle="white";
        ctx.font="26px Arial";
        ctx.fillText(msg, 100,260);
    }

    ctx.font="18px Arial";
    ctx.fillText("Tap To Restart", 110,360);

    canvas.onclick = ()=> location.reload();
}
</script>
</body>
</html>
