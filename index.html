<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Floppy F4ck Maker</title>
<style>
    body { margin:0; font-family:Arial; background:#111; color:white; text-align:center; }
    h1 { font-size:28px; color:#0fdb8f; margin-top:10px; }
    h3 { color:#bbb; font-size:14px; margin-bottom:20px; }

    #menu {
        padding:20px; max-width:420px; margin:auto;
        background:#1c1c1c; border-radius:10px;
    }

    label { font-size:15px; margin-top:14px; display:block; }
    input { display:block; margin:6px auto 14px auto; color:white; }
    button {
        background:#00eaff; border:none; padding:12px 25px;
        border-radius:8px; cursor:pointer; margin-top:10px;
        font-size:16px; font-weight:bold;
    }
    button:hover { background:#00cce0; }

    #gameCanvas { display:none; background:black; margin:auto; margin-top:20px; }
</style>
</head>
<body>

<h1>Floppy F4ck</h1>
<h3>“Why should developers have all the fun?”</h3>

<div id="menu">
    <h2>Create Your Game</h2>

    <label>Character Image</label>
    <input type="file" id="charImg" accept="image/*">

    <label>Obstacle Image</label>
    <input type="file" id="obImg" accept="image/*">

    <label>Background Image</label>
    <input type="file" id="bgImg" accept="image/*">

    <label>Game Music (mp3)</label>
    <input type="file" id="bgMusic" accept="audio/*">

    <label>Death Sound</label>
    <input type="file" id="deathSound" accept="audio/*">

    <label>Game Over Text</label>
    <input type="text" id="goText" placeholder="Game Over!">

    <label>Game Over Image (Optional)</label>
    <input type="file" id="goImg" accept="image/*">

    <button onclick="initGame()">Generate Game</button>
</div>


<canvas id="gameCanvas" width="360" height="600"></canvas>


<script>
let canvas = document.getElementById("gameCanvas");
let ctx = canvas.getContext("2d");

let charImg = new Image();
let obImg = new Image();
let bgImg = new Image();
let goImg = new Image();

let bgMusic = new Audio();
let deathMusic = new Audio();

let player, pipes, score, dead, goText;
let gravity = 0.32;
let jumpPower = -10;
let pipeSpeed = 1.8;
let gap = 220;
let pipeWidth = 60;
let charSize = 38;
let spawnTimer;

function toBase64(file) {
    return new Promise(res=>{
        if(!file) return res("");
        let r = new FileReader();
        r.onload = ()=>res(r.result);
        r.readAsDataURL(file);
    });
}

async function initGame() {
    let ci = await toBase64(document.getElementById("charImg").files[0]);
    let oi = await toBase64(document.getElementById("obImg").files[0]);
    let bi = await toBase64(document.getElementById("bgImg").files[0]);
    let bm = await toBase64(document.getElementById("bgMusic").files[0]);
    let dm = await toBase64(document.getElementById("deathSound").files[0]);
    let gi = await toBase64(document.getElementById("goImg").files[0]);

    charImg.src = ci;
    obImg.src = oi;
    bgImg.src = bi;
    bgMusic.src = bm;
    deathMusic.src = dm;
    goImg.src = gi;

    goText = document.getElementById("goText").value || "Game Over!";

    startGame();
}

function resetGame() {
    player = { x:100, y:250, vy:0 };
    pipes = [];
    score = 0;
    dead = false;

    clearInterval(spawnTimer);
    spawnTimer = setInterval(createPipe, 1700);

    bgMusic.currentTime = 0;
    if(bgMusic.src) bgMusic.play();
}

function startGame() {
    document.getElementById("menu").style.display="none";
    canvas.style.display="block";

    canvas.onclick = jump;
    canvas.addEventListener("touchstart", jump);

    resetGame();
    requestAnimationFrame(loop);
}

function jump(){
    if(dead){
        resetGame();
        return;
    }
    player.vy = jumpPower;
}

function createPipe(){
    let topH = Math.random()*230 + 60;
    pipes.push({ x:360, top: topH });
}

function loop() {
    if(!dead) update();
    render();
    requestAnimationFrame(loop);
}

function update(){
    player.vy += gravity;
    player.y += player.vy;

    for(let p of pipes){
        p.x -= pipeSpeed;

        if(player.x + charSize > p.x && player.x < p.x + pipeWidth &&
        (player.y < p.top || player.y + charSize > p.top + gap)) {
            die();
        }

        if(p.x + pipeWidth === player.x) score++;
    }

    if(player.y > 560 || player.y < 0) die();
}

function die(){
    dead = true;
    bgMusic.pause();
    if(deathMusic.src) deathMusic.play();
}

function render(){
    ctx.clearRect(0,0,360,600);

    if(bgImg.src) ctx.drawImage(bgImg,0,0,360,600);

    for(let p of pipes){
        ctx.drawImage(obImg, p.x, 0, pipeWidth, p.top);
        ctx.drawImage(obImg, p.x, p.top + gap, pipeWidth, 600 - p.top - gap);
    }

    ctx.drawImage(charImg, player.x, player.y, charSize, charSize);

    ctx.fillStyle="white";
    ctx.font="26px Arial";
    ctx.fillText("Score: "+score, 10,30);

    if(dead){
        ctx.fillStyle="rgba(0,0,0,0.6)";
        ctx.fillRect(0,0,360,600);

        if(goImg.src){
            ctx.drawImage(goImg,80,150,200,200);
        }else{
            ctx.fillStyle="white";
            ctx.font="32px Arial";
            ctx.fillText(goText, 95,260);
        }

        ctx.font="20px Arial";
        ctx.fillText("Tap to Restart",110,330);
    }
}
</script>

</body>
</html>
